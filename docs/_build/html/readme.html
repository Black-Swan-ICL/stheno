

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stheno &mdash; stheno 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Application Programming Interface" href="api.html" />
    <link rel="prev" title="Welcome" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> stheno
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Stheno</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#nonlinear-regression-in-20-seconds">Nonlinear Regression in 20 Seconds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manual">Manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#kernel-and-mean-design">Kernel and Mean Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#available-kernels">Available Kernels</a></li>
<li class="toctree-l4"><a class="reference internal" href="#available-means">Available Means</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compositional-design">Compositional Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#displaying-kernels-and-means">Displaying Kernels and Means</a></li>
<li class="toctree-l4"><a class="reference internal" href="#properties-of-kernels">Properties of Kernels</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#model-design">Model Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Compositional Design</a></li>
<li class="toctree-l4"><a class="reference internal" href="#displaying-gps">Displaying GPs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#properties-of-gps">Properties of GPs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#naming-gps">Naming GPs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#finite-dimensional-distributions-inference-and-sampling">Finite-Dimensional Distributions, Inference, and Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inducing-points">Inducing Points</a></li>
<li class="toctree-l3"><a class="reference internal" href="#numpy-tensorflow-or-pytorch">NumPy, TensorFlow, or PyTorch?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#undiscussed-features">Undiscussed Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simple-regression">Simple Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decomposition-of-prediction">Decomposition of Prediction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#learn-a-function-incorporating-prior-knowledge-about-its-form">Learn a Function, Incorporating Prior Knowledge About Its Form</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multi-ouput-regression">Multi-Ouput Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#approximate-integration">Approximate Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bayesian-linear-regression">Bayesian Linear Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gpar">GPAR</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-gprnn-model">A GP–RNN Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="#approximate-multiplication-between-gps">Approximate Multiplication Between GPs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sparse-regression">Sparse Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#smoothing-with-nonparametric-basis-functions">Smoothing with Nonparametric Basis Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Application Programming Interface</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">stheno</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Stheno</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/readme.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stheno">
<h1><a class="reference external" href="https://github.com/wesselb/stheno">Stheno</a><a class="headerlink" href="#stheno" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://travis-ci.org/wesselb/stheno"><img alt="Build" src="https://travis-ci.org/wesselb/stheno.svg?branch=master" /></a> <a class="reference external" href="https://coveralls.io/github/wesselb/stheno?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/wesselb/stheno/badge.svg?branch=master&amp;service=github" /></a> <a class="reference external" href="https://wesselb.github.io/stheno"><img alt="Latest Docs" src="https://img.shields.io/badge/docs-latest-blue.svg" /></a></p>
<p>Stheno is an implementation of Gaussian process modelling in Python. See
also <a class="reference external" href="https://github.com/willtebbutt/Stheno.jl">Stheno.jl</a>.</p>
<ul class="simple">
<li><p><a class="reference external" href="#nonlinear-regression-in-20-seconds">Nonlinear Regression in 20
Seconds</a></p></li>
<li><p><a class="reference external" href="#installation">Installation</a></p></li>
<li><p><a class="reference external" href="#manual">Manual</a></p>
<ul>
<li><p><a class="reference external" href="#kernel-and-mean-design">Kernel and Mean Design</a></p>
<ul>
<li><p><a class="reference external" href="#available-kernels">Available Kernels</a></p></li>
<li><p><a class="reference external" href="#available-means">Available Means</a></p></li>
<li><p><a class="reference external" href="#compositional-design">Compositional Design</a></p></li>
<li><p><a class="reference external" href="#displaying-kernels-and-mean">Displaying Kernels and Means</a></p></li>
<li><p><a class="reference external" href="#properties-of-kernels">Properties of Kernels</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#model-design">Model Design</a></p>
<ul>
<li><p><a class="reference external" href="#compositional-design">Compositional Design</a></p></li>
<li><p><a class="reference external" href="#displaying-gps">Displaying GPs</a></p></li>
<li><p><a class="reference external" href="#properties-of-gps">Properties of GPs</a></p></li>
<li><p><a class="reference external" href="#naming-gps">Naming GPs</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#inference-and-sampling">Inference and Sampling</a></p></li>
<li><p><a class="reference external" href="#inducing-points">Inducing Points</a></p></li>
<li><p><a class="reference external" href="#numpy-tensorflow-or-pytorch">NumPy, TensorFlow, or PyTorch?</a></p></li>
<li><p><a class="reference external" href="#undiscussed-features">Undiscussed Features</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="#examples">Examples</a></p>
<ul>
<li><p><a class="reference external" href="#simple-regression">Simple Regression</a></p></li>
<li><p><a class="reference external" href="#decomposition-of-prediction">Decomposition of Prediction</a></p></li>
<li><p><a class="reference external" href="#learn-a-function-incorporating-prior-knowledge-about-its-form">Learn a Function, Incorporating Prior Knowledge About Its
Form</a></p></li>
<li><p><a class="reference external" href="#multi-ouput-regression">Multi-Output Regression</a></p></li>
<li><p><a class="reference external" href="#approximate-integration">Approximate Integration</a></p></li>
<li><p><a class="reference external" href="#bayesian-linear-regression">Bayesian Linear Regression</a></p></li>
<li><p><a class="reference external" href="#gpar">GPAR</a></p></li>
<li><p><a class="reference external" href="#a-gprnn-model">A GP–RNN Model</a></p></li>
<li><p><a class="reference external" href="#approximate-multiplication-between-gps">Approximate Multiplication Between
GPs</a></p></li>
<li><p><a class="reference external" href="#sparse-regression">Sparse Regression</a></p></li>
<li><p><a class="reference external" href="#smoothing-with-nonparametric-basis-functions">Smoothing with Nonparametric Basis
Functions</a></p></li>
</ul>
</li>
</ul>
<div class="section" id="nonlinear-regression-in-20-seconds">
<h2>Nonlinear Regression in 20 Seconds<a class="headerlink" href="#nonlinear-regression-in-20-seconds" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>    <span class="c1"># Points to predict at</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>                   <span class="c1"># Observations</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span>  <span class="c1"># Go GP!</span>
<span class="go">array([[8.48258669]])</span>
</pre></div>
</div>
<p>Moar?! Then read on!</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>The package is tested for Python 2.7 and Python 3.6, which are the
versions recommended to use. To install the package, use the following
sequence of commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/wesselb/stheno
<span class="nb">cd</span> stheno
make install
</pre></div>
</div>
</div>
<div class="section" id="manual">
<h2>Manual<a class="headerlink" href="#manual" title="Permalink to this headline">¶</a></h2>
<p>Note: <a class="reference external" href="https://stheno.readthedocs.io/en/latest">here</a> is a nicely
rendered and more readable version of the docs.</p>
<div class="section" id="kernel-and-mean-design">
<h3>Kernel and Mean Design<a class="headerlink" href="#kernel-and-mean-design" title="Permalink to this headline">¶</a></h3>
<p>Inputs to kernels, means, and GPs, henceforth referred to simply as
<em>inputs</em>, must be of one of the following three forms:</p>
<ul class="simple">
<li><p>If the input <code class="docutils literal notranslate"><span class="pre">x</span></code> is a <em>rank 0 tensor</em>, i.e. a scalar, then <code class="docutils literal notranslate"><span class="pre">x</span></code>
refers to a single input location. For example, <code class="docutils literal notranslate"><span class="pre">0</span></code> simply refers
to the sole input location <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>If the input <code class="docutils literal notranslate"><span class="pre">x</span></code> is a <em>rank 1 tensor</em>, then every element of <code class="docutils literal notranslate"><span class="pre">x</span></code>
is interpreted as a separate input location. For example,
<code class="docutils literal notranslate"><span class="pre">np.linspace(0,</span> <span class="pre">1,</span> <span class="pre">10)</span></code> generates 10 different input locations
ranging from <code class="docutils literal notranslate"><span class="pre">0</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p>If the input <code class="docutils literal notranslate"><span class="pre">x</span></code> is a <em>rank 2 tensor</em>, then every <em>row</em> of <code class="docutils literal notranslate"><span class="pre">x</span></code> is
interpreted as a separate input location. In this case inputs are
multi-dimensional, and the columns correspond to the various input
dimensions.</p></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">k</span></code> is a kernel, say <code class="docutils literal notranslate"><span class="pre">k</span> <span class="pre">=</span> <span class="pre">EQ()</span></code>, then <code class="docutils literal notranslate"><span class="pre">k(x,</span> <span class="pre">y)</span></code> constructs the
<em>kernel matrix</em> for all pairs of points between <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.
<code class="docutils literal notranslate"><span class="pre">k(x)</span></code> is shorthand for <code class="docutils literal notranslate"><span class="pre">k(x,</span> <span class="pre">x)</span></code>. Furthermore, <code class="docutils literal notranslate"><span class="pre">k.elwise(x,</span> <span class="pre">y)</span></code>
constructs the <em>kernel vector</em> pairing the points in <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>
element wise, which will be a <em>rank 2 column vector</em>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">array([[1.        , 0.8824969 , 0.60653066],</span>
<span class="go">       [0.8824969 , 1.        , 0.8824969 ],</span>
<span class="go">       [0.60653066, 0.8824969 , 1.        ]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">elwise</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">array([[1.        ],</span>
<span class="go">       [0.8824969 ],</span>
<span class="go">       [0.60653066]])</span>
</pre></div>
</div>
<p>Finally, mean functions output a <em>rank 2 column vector</em>.</p>
<div class="section" id="available-kernels">
<h4>Available Kernels<a class="headerlink" href="#available-kernels" title="Permalink to this headline">¶</a></h4>
<p>Constants function as constant kernels. Besides that, the following
kernels are available:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">EQ()</span></code>, the exponentiated quadratic:</p>
<div class="math notranslate nohighlight">
\[k(x, y) = \exp\left( -\frac{1}{2}\|x - y\|^2 \right);\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">RQ(alpha)</span></code>, the rational quadratic:</p>
<div class="math notranslate nohighlight">
\[k(x, y) = \left( 1 + \frac{\|x - y\|^2}{2 \alpha} \right)^{-\alpha};\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Exp()</span></code> or <code class="docutils literal notranslate"><span class="pre">Matern12()</span></code>, the exponential kernel:</p>
<div class="math notranslate nohighlight">
\[k(x, y) = \exp\left( -\|x - y\| \right);\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Matern32()</span></code>, the Matern–3/2 kernel:</p>
<div class="math notranslate nohighlight">
\[k(x, y) = \left(
   1 + \sqrt{3}\|x - y\|
   \right)\exp\left(-\sqrt{3}\|x - y\|\right);\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Matern52()</span></code>, the Matern–5/2 kernel:</p>
<div class="math notranslate nohighlight">
\[k(x, y) = \left(
   1 + \sqrt{5}\|x - y\| + \frac{5}{3} \|x - y\|^2
  \right)\exp\left(-\sqrt{3}\|x - y\|\right);\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">Delta()</span></code>, the Kronecker delta kernel:</p>
<div class="math notranslate nohighlight">
\[\begin{split}k(x, y) = \begin{cases}
   1 &amp; \text{if } x = y, \\
   0 &amp; \text{otherwise};
  \end{cases}\end{split}\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">DecayingKernel(alpha,</span> <span class="pre">beta)</span></code>:</p>
<div class="math notranslate nohighlight">
\[k(x, y) = \frac{\|\beta\|^\alpha}{\|x + y + \beta\|^\alpha};\]</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">TensorProductKernel(f)</span></code>:</p>
<div class="math notranslate nohighlight">
\[k(x, y) = f(x)f(y).\]</div>
<p>Adding or multiplying a <code class="docutils literal notranslate"><span class="pre">FunctionType</span></code> <code class="docutils literal notranslate"><span class="pre">f</span></code> to or with a kernel
will automatically translate <code class="docutils literal notranslate"><span class="pre">f</span></code> to <code class="docutils literal notranslate"><span class="pre">TensorProductKernel(f)</span></code>. For
example, <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">*</span> <span class="pre">k</span></code> will translate to <code class="docutils literal notranslate"><span class="pre">TensorProductKernel(f)</span> <span class="pre">*</span> <span class="pre">k</span></code>,
and <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">+</span> <span class="pre">k</span></code> will translate to <code class="docutils literal notranslate"><span class="pre">TensorProductKernel(f)</span> <span class="pre">+</span> <span class="pre">k</span></code>.</p>
</li>
</ul>
</div>
<div class="section" id="available-means">
<h4>Available Means<a class="headerlink" href="#available-means" title="Permalink to this headline">¶</a></h4>
<p>Constants function as constant means. Besides that, the following means
are available:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">TensorProductMean(f)</span></code>:</p>
<div class="math notranslate nohighlight">
\[m(x) = f(x).\]</div>
<p>Adding or multiplying a <code class="docutils literal notranslate"><span class="pre">FunctionType</span></code> <code class="docutils literal notranslate"><span class="pre">f</span></code> to or with a mean will
automatically translate <code class="docutils literal notranslate"><span class="pre">f</span></code> to <code class="docutils literal notranslate"><span class="pre">TensorProductMean(f)</span></code>. For
example, <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">*</span> <span class="pre">m</span></code> will translate to <code class="docutils literal notranslate"><span class="pre">TensorProductMean(f)</span> <span class="pre">*</span> <span class="pre">m</span></code>,
and <code class="docutils literal notranslate"><span class="pre">f</span> <span class="pre">+</span> <span class="pre">m</span></code> will translate to <code class="docutils literal notranslate"><span class="pre">TensorProductMean(f)</span> <span class="pre">+</span> <span class="pre">m</span></code>.</p>
</li>
</ul>
</div>
<div class="section" id="compositional-design">
<h4>Compositional Design<a class="headerlink" href="#compositional-design" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Add and subtract <em>kernels and means</em>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">+</span> <span class="n">Exp</span><span class="p">()</span>
<span class="go">EQ() + Exp()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">+</span> <span class="n">EQ</span><span class="p">()</span>
<span class="go">2 * EQ()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">EQ() + 1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">+</span> <span class="mi">0</span>
<span class="go">EQ()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">-</span> <span class="n">Exp</span><span class="p">()</span>
<span class="go">EQ() - Exp()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">-</span> <span class="n">EQ</span><span class="p">()</span>
<span class="go">0</span>
</pre></div>
</div>
</li>
<li><p>Multiply <em>kernels and means</em>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">*</span> <span class="n">Exp</span><span class="p">()</span>
<span class="go">EQ() * Exp()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span>
<span class="go">2 * EQ()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span>
<span class="go">0</span>
</pre></div>
</div>
</li>
<li><p>Shift <em>kernels and means</em>:</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">c</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span>

<span class="n">k</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">c1</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">c2</span><span class="p">)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Linear</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">Linear() shift 1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">EQ() shift (1, 2)</span>
</pre></div>
</div>
</li>
<li><p>Stretch <em>kernels and means</em>.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">c</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>

<span class="n">k</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">c1</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="n">c2</span><span class="p">)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">EQ() &gt; 2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">EQ() &gt; (2, 3)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> operator is implemented to provide a shorthand for
stretching:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">2</span>
<span class="go">EQ() &gt; 2</span>
</pre></div>
</div>
</li>
<li><p>Select particular input dimensions of <em>kernels and means</em>.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="mi">0</span><span class="p">])(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

<span class="n">k</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">y</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>

<span class="n">k</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">k</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
<span class="go">EQ() : [0]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="go">EQ() : [0, 1]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">EQ() : ([0], [1])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="go">EQ() : (None, [1])</span>
</pre></div>
</div>
</li>
<li><p>Transform the inputs of <em>kernels and means</em>.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="n">k</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f2</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="n">k</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">EQ() transform f</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
<span class="go">EQ() transform (f1, f2)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="go">EQ() transform (None, f)</span>
</pre></div>
</div>
</li>
<li><p>Numerically, but efficiently, take derivatives of <em>kernels and
means</em>. This currently only works in TensorFlow and derivatives
cannot be nested.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">0</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">d</span><span class="o">/</span><span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="n">d</span><span class="o">/</span><span class="n">d</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">k</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">d</span><span class="o">/</span><span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span> <span class="n">d</span><span class="o">/</span><span class="n">d</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">k</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">d</span><span class="o">/</span><span class="n">d</span><span class="p">(</span><span class="n">y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="n">k</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">d(0) EQ()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">d(0, 1) EQ()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">d(None, 1) EQ()</span>
</pre></div>
</div>
</li>
<li><p>Make <em>kernels</em> periodic, but <em>not means</em>.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">k</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">2</span> <span class="n">pi</span> <span class="o">/</span> <span class="n">w</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">((</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">x</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">x</span><span class="p">)),</span> <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">y</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">y</span><span class="p">)))</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">EQ() per 1</span>
</pre></div>
</div>
</li>
<li><p>Reverse the arguments of <em>kernels</em>, but <em>not means</em>.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">reversed</span><span class="p">(</span><span class="n">k</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">k</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">reversed</span><span class="p">(</span><span class="n">Linear</span><span class="p">())</span>
<span class="go">Reversed(Linear())</span>
</pre></div>
</div>
</li>
<li><p>Extract terms and factors from sums and products respectively of
<em>kernels and means</em>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span> <span class="o">+</span> <span class="n">RQ</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Linear</span><span class="p">())</span><span class="o">.</span><span class="n">term</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">RQ(0.1)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span> <span class="o">*</span> <span class="n">Linear</span><span class="p">)</span><span class="o">.</span><span class="n">factor</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Kernels and means “wrapping” others can be “unwrapped” by indexing
<code class="docutils literal notranslate"><span class="pre">k[0]</span></code> or <code class="docutils literal notranslate"><span class="pre">m[0]</span></code>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">reversed</span><span class="p">(</span><span class="n">Linear</span><span class="p">())</span>
<span class="go">Reversed(Linear())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">reversed</span><span class="p">(</span><span class="n">Linear</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">Linear()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">EQ() per 1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">EQ()</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="displaying-kernels-and-means">
<h4>Displaying Kernels and Means<a class="headerlink" href="#displaying-kernels-and-means" title="Permalink to this headline">¶</a></h4>
<p>Kernels and means have a <code class="docutils literal notranslate"><span class="pre">display</span></code> method. The <code class="docutils literal notranslate"><span class="pre">display</span></code> method
accepts a callable formatter that will be applied before any value is
printed. This comes in handy when pretty printing kernels, or when
kernels contain TensorFlow objects.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">((</span><span class="mf">2.12345</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;{:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="go">2.12 * EQ(), 0</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span>
<span class="go">Tensor(&quot;Const_1:0&quot;, shape=(), dtype=int32) * EQ()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">((</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">))</span>
<span class="go">2 * EQ()</span>
</pre></div>
</div>
</div>
<div class="section" id="properties-of-kernels">
<h4>Properties of Kernels<a class="headerlink" href="#properties-of-kernels" title="Permalink to this headline">¶</a></h4>
<p>The stationarity of a kernel <code class="docutils literal notranslate"><span class="pre">k</span></code> can always be determined by querying
<code class="docutils literal notranslate"><span class="pre">k.stationary</span></code>. In many cases, the variance <code class="docutils literal notranslate"><span class="pre">k.var</span></code>, length scale
<code class="docutils literal notranslate"><span class="pre">k.length_scale</span></code>, and period <code class="docutils literal notranslate"><span class="pre">k.period</span></code> can also be determined.</p>
<p>Example of querying the stationarity:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stationary</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span> <span class="o">+</span> <span class="n">Linear</span><span class="p">())</span><span class="o">.</span><span class="n">stationary</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Example of querying the variance:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">var</span>
<span class="go">1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">var</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Example of querying the length scale:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">length_scale</span>
<span class="go">1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span> <span class="o">+</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">length_scale</span>
<span class="go">1.5</span>
</pre></div>
</div>
<p>Example of querying the period:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">period</span>
<span class="go">1</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">period</span>
<span class="go">2</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="model-design">
<h3>Model Design<a class="headerlink" href="#model-design" title="Permalink to this headline">¶</a></h3>
<p>The basic building block of a model is a
<code class="docutils literal notranslate"><span class="pre">GP(kernel,</span> <span class="pre">mean=0,</span> <span class="pre">graph=model)</span></code>, which necessarily takes in a
kernel, and optionally a mean and a <em>graph</em>. GPs can be combined into
new GPs, and the graph is the thing that keeps track of all of these
objects. If the graph is left unspecified, new GPs are appended to a
provided default graph <code class="docutils literal notranslate"><span class="pre">model</span></code>, which is exported by Stheno:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">model</span>
</pre></div>
</div>
<p>Here’s an example model:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span>
<span class="go">GP(EQ(), &lt;lambda&gt;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Linear</span><span class="p">())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_sum</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">f2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f_sum</span>
<span class="go">GP(EQ() + Linear(), &lt;lambda&gt;)</span>
</pre></div>
</div>
<div class="section" id="id1">
<h4>Compositional Design<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Add and subtract GPs and other objects.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="n">GP</span><span class="p">(</span><span class="n">Exp</span><span class="p">())</span>
<span class="go">GP(EQ() + Exp(), 0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="go">GP(2 * EQ(), 0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">GP(EQ(), 1)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="mi">0</span>
<span class="go">GP(EQ(), 0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">+</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">GP(EQ(), &lt;lambda&gt;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">GP(2 * EQ(), 1)</span>
</pre></div>
</div>
</li>
<li><p>Multiply GPs by other objects.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="go">GP(2 * EQ(), 0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="mi">0</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="go">GP(0, 0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="go">GP(&lt;lambda&gt; * EQ(), 0)</span>
</pre></div>
</div>
</li>
<li><p>Shift GPs.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">GP(EQ() shift 1, 0)</span>
</pre></div>
</div>
</li>
<li><p>Stretch GPs.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">GP(EQ() &gt; 2, 0)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> operator is implemented to provide a shorthand for
stretching:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">2</span>
<span class="go">GP(EQ() &gt; 2, 0)</span>
</pre></div>
</div>
</li>
<li><p>Select particular input dimensions.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">GP(EQ() : [1, 3], 0)</span>
</pre></div>
</div>
<p>Indexing is implemented to provide a a shorthand for selecting input
dimensions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="go">GP(EQ() : [1, 3], 0)</span>
</pre></div>
</div>
</li>
<li><p>Transform the input.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">GP(EQ() transform f, 0)</span>
</pre></div>
</div>
</li>
<li><p>Numerically take the derivative of a GP. The argument specifies which
dimension to take the derivative with respect to.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">GP(d(1) EQ(), 0)</span>
</pre></div>
</div>
</li>
<li><p>Construct a finite difference estimate of the derivative of a GP. See
<code class="docutils literal notranslate"><span class="pre">stheno.graph.Graph.diff_approx</span></code> for a description of the
arguments.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">diff_approx</span><span class="p">(</span><span class="n">deriv</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">GP(50000000.0 * (0.5 * EQ() + 0.5 * ((-0.5 * (EQ() shift (0.0001414213562373095, 0))) shift (0, -0.0001414213562373095)) + 0.5 * ((-0.5 * (EQ() shift (0, 0.0001414213562373095))) shift (-0.0001414213562373095, 0))), 0)</span>
</pre></div>
</div>
</li>
<li><p>Construct the Cartesian product of a collection of GPs.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">model</span><span class="p">),</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>
<span class="go">GP(MultiOutputKernel(EQ(), EQ()), MultiOutputMean(0, 0))</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="displaying-gps">
<h4>Displaying GPs<a class="headerlink" href="#displaying-gps" title="Permalink to this headline">¶</a></h4>
<p>Like kernels and means, GPs have a <code class="docutils literal notranslate"><span class="pre">display</span></code> method that accepts a
formatter.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span><span class="p">(</span><span class="n">GP</span><span class="p">(</span><span class="mf">2.12345</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;{:.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
<span class="go">GP(2.12 * EQ(), 0)</span>
</pre></div>
</div>
</div>
<div class="section" id="properties-of-gps">
<h4>Properties of GPs<a class="headerlink" href="#properties-of-gps" title="Permalink to this headline">¶</a></h4>
<p>Properties of kernels can be queried on GPs directly.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stationary</span>
<span class="go">True</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">RQ</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">))</span><span class="o">.</span><span class="n">length_scale</span>
<span class="go">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="naming-gps">
<h3>Naming GPs<a class="headerlink" href="#naming-gps" title="Permalink to this headline">¶</a></h3>
<p>It is possible to give a name to GPs. Names must be strings. A graph
then behaves like a two-way dictionary between GPs and their names.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;prior&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">name</span>
<span class="go">&#39;prior&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;alternative_prior&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">[</span><span class="s1">&#39;alternative_prior&#39;</span><span class="p">]</span>
<span class="go">GP(EQ(), 0)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="p">[</span><span class="n">p</span><span class="p">]</span>
<span class="go">&#39;alternative_prior&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="finite-dimensional-distributions-inference-and-sampling">
<h3>Finite-Dimensional Distributions, Inference, and Sampling<a class="headerlink" href="#finite-dimensional-distributions-inference-and-sampling" title="Permalink to this headline">¶</a></h3>
<p>Simply call a GP to construct its finite-dimensional distribution:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="go">stheno.random.Normal</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span>
<span class="go">array([[0.],</span>
<span class="go">       [0.],</span>
<span class="go">       [0.]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">var</span>
<span class="go">array([[1.        , 0.8824969 , 0.60653066],</span>
<span class="go">       [0.8824969 , 1.        , 0.8824969 ],</span>
<span class="go">       [0.60653066, 0.8824969 , 1.        ]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">array([[-0.47676132],</span>
<span class="go">       [-0.51696144],</span>
<span class="go">       [-0.77643117]])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
<span class="go">-1.348196150807441</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">y2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
<span class="go"> array([-1.00581476, -1.67625465])</span>
</pre></div>
</div>
<p>If you wish to compute the evidence of multiple observations, then
<code class="docutils literal notranslate"><span class="pre">Graph.logpdf</span></code> can be used.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Graph</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">Graph</span><span class="o">.</span><span class="n">logpdf</span><span class="p">((</span><span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Furthermore, use <code class="docutils literal notranslate"><span class="pre">f(x).marginals()</span></code> to efficiently compute the means
and the marginal lower and upper 95% central credible region bounds:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="go">(array([0., 0., 0.]), array([-2., -2., -2.]), array([2., 2., 2.]))</span>
</pre></div>
</div>
<p>To condition on observations, use <code class="docutils literal notranslate"><span class="pre">Graph.condition</span></code> or
<code class="docutils literal notranslate"><span class="pre">GP.condition</span></code>. Syntax is much like the math: compare
<code class="docutils literal notranslate"><span class="pre">f1_posterior</span> <span class="pre">=</span> <span class="pre">f1</span> <span class="pre">|</span> <span class="pre">(f2(x),</span> <span class="pre">y)</span></code> with <span class="math notranslate nohighlight">\(f_1 \,|\, f_2(x) = y\)</span>.</p>
<p>Definition, where <code class="docutils literal notranslate"><span class="pre">f*</span></code> and <code class="docutils literal notranslate"><span class="pre">g*</span></code> are <code class="docutils literal notranslate"><span class="pre">GP</span></code>s:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f_posterior</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="n">f_posterior</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">g1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">f_posterior</span> <span class="o">=</span> <span class="n">f</span> <span class="o">|</span> <span class="p">((</span><span class="n">g1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">g2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>

<span class="n">f1_posterior</span><span class="p">,</span> <span class="n">f2_posterior</span><span class="p">,</span> <span class="o">...</span> <span class="o">=</span> <span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="o">|</span> <span class="n">Obs</span><span class="p">(</span><span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">f1_posterior</span><span class="p">,</span> <span class="n">f2_posterior</span><span class="p">,</span> <span class="o">...</span> <span class="o">=</span> <span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="o">|</span> <span class="n">Obs</span><span class="p">((</span><span class="n">g1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">g2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">Graph.sample</span></code> can be used to get samples from multiple
processes jointly:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f</span><span class="p">)(</span><span class="n">x</span><span class="p">))</span>
<span class="go">[array([[-0.35226314],</span>
<span class="go">        [-0.15521219],</span>
<span class="go">        [ 0.0752406 ]]),</span>
<span class="go"> array([[-0.70452827],</span>
<span class="go">        [-0.31042226],</span>
<span class="go">        [ 0.15048168]])]</span>
</pre></div>
</div>
</div>
<div class="section" id="inducing-points">
<h3>Inducing Points<a class="headerlink" href="#inducing-points" title="Permalink to this headline">¶</a></h3>
<p>Stheno supports sparse approximations of posterior distributions. To
construct a sparse approximation, use <code class="docutils literal notranslate"><span class="pre">SparseObs</span></code> instead of <code class="docutils literal notranslate"><span class="pre">Obs</span></code>.</p>
<p>Definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obs</span> <span class="o">=</span> <span class="n">SparseObs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">z</span><span class="p">),</span>  <span class="c1"># Locations of inducing points.</span>
                <span class="n">e</span><span class="p">,</span>     <span class="c1"># Independent, additive noise process.</span>
                <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>  <span class="c1"># Locations of observations _without_ the noise</span>
                       <span class="c1">#   process added.</span>
                <span class="n">y</span><span class="p">)</span>     <span class="c1"># Observations.</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">SparseObs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">SparseObs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">e2</span><span class="p">,</span> <span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">SparseObs</span><span class="p">((</span><span class="n">u1</span><span class="p">(</span><span class="n">z1</span><span class="p">),</span> <span class="n">u2</span><span class="p">(</span><span class="n">z2</span><span class="p">),</span> <span class="o">...</span><span class="p">),</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">SparseObs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">z</span><span class="p">),</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">e2</span><span class="p">,</span> <span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">SparseObs</span><span class="p">((</span><span class="n">u1</span><span class="p">(</span><span class="n">z1</span><span class="p">),</span> <span class="n">u2</span><span class="p">(</span><span class="n">z2</span><span class="p">),</span> <span class="o">...</span><span class="p">),</span> <span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">f1</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">e2</span><span class="p">,</span> <span class="n">f2</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">y2</span><span class="p">),</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SparseObs</span></code> will also compute the value of the ELBO in <code class="docutils literal notranslate"><span class="pre">obs.elbo</span></code>,
which can be optimised to select hyperparameters and locations of the
inducing points.</p>
</div>
<div class="section" id="numpy-tensorflow-or-pytorch">
<h3>NumPy, TensorFlow, or PyTorch?<a class="headerlink" href="#numpy-tensorflow-or-pytorch" title="Permalink to this headline">¶</a></h3>
<p>Your choice!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno.tf</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stheno.torch</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span>
</pre></div>
</div>
</div>
<div class="section" id="undiscussed-features">
<h3>Undiscussed Features<a class="headerlink" href="#undiscussed-features" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">stheno.mokernel</span></code> and <code class="docutils literal notranslate"><span class="pre">stheno.momean</span></code> offer multi-output kernels
and means.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">model</span><span class="p">),</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span>
<span class="go">GP(MultiOutputKernel(EQ(), EQ()), MultiOutputMean(0, 0))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="go">array([[ 1.1725799 ],</span>
<span class="go">       [-1.15642448]])</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">stheno.eis</span></code> offers kernels on an extended input space that allows
one to design kernels in an alternative, flexible way.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">NoisyKernel</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">Delta</span><span class="p">()))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">prediction</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">Observed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)(</span><span class="n">Latent</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">stheno.normal</span></code> offers an efficient implementation <code class="docutils literal notranslate"><span class="pre">Normal</span></code> of
the normal distribution, and a convenience constructor <code class="docutils literal notranslate"><span class="pre">Normal1D</span></code>
for 1-dimensional normal distributions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stheno.matrix</span></code> offers structured representations of matrices and
efficient operations thereon.</p></li>
<li><p>Approximate multiplication between GPs is implemented. This is an
experimental feature.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="go">GP(&lt;lambda&gt; * EQ() + &lt;lambda&gt; * EQ() + EQ() * EQ(), &lt;lambda&gt; + &lt;lambda&gt; + -1 * 1)</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simple-regression">
<h3>Simple Regression<a class="headerlink" href="#simple-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id2">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction1_simple_regression.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">model</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># Construct a prior.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mf">5.</span><span class="p">))</span>  <span class="c1"># Latent function.</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>  <span class="c1"># Noise.</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">e</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">f_true</span><span class="p">,</span> <span class="n">y_obs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">))</span>

<span class="c1"># Now condition on the observations to make predictions.</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="decomposition-of-prediction">
<h3>Decomposition of Prediction<a class="headerlink" href="#decomposition-of-prediction" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id3">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction2_decomposition.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">RQ</span><span class="p">,</span> <span class="n">Linear</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">Exp</span><span class="p">,</span> <span class="n">Obs</span><span class="p">,</span> <span class="n">B</span>

<span class="n">B</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-10</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Construct a latent function consisting of four different components.</span>
<span class="n">f_smooth</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span>
<span class="n">f_wiggly</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">RQ</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">)</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">))</span>
<span class="n">f_periodic</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
<span class="n">f_linear</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Linear</span><span class="p">())</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">f_smooth</span> <span class="o">+</span> <span class="n">f_wiggly</span> <span class="o">+</span> <span class="n">f_periodic</span> <span class="o">+</span> <span class="o">.</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f_linear</span>

<span class="c1"># Let the observation noise consist of a bit of exponential noise.</span>
<span class="n">e_indep</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>
<span class="n">e_exp</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Exp</span><span class="p">())</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">e_indep</span> <span class="o">+</span> <span class="o">.</span><span class="mi">3</span> <span class="o">*</span> <span class="n">e_exp</span>

<span class="c1"># Sum the latent function and observation noise to get a model for the</span>
<span class="c1"># observations.</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">e</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">f_true_smooth</span><span class="p">,</span> <span class="n">f_true_wiggly</span><span class="p">,</span> <span class="n">f_true_periodic</span><span class="p">,</span> <span class="n">f_true_linear</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">y_obs</span> <span class="o">=</span> \
    <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                 <span class="n">f_wiggly</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                 <span class="n">f_periodic</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                 <span class="n">f_linear</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                 <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
                 <span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">))</span>

<span class="c1"># Now condition on the observations and make predictions for the latent</span>
<span class="c1"># function and its various components.</span>
<span class="n">f_smooth</span><span class="p">,</span> <span class="n">f_wiggly</span><span class="p">,</span> <span class="n">f_periodic</span><span class="p">,</span> <span class="n">f_linear</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> \
    <span class="p">(</span><span class="n">f_smooth</span><span class="p">,</span> <span class="n">f_wiggly</span><span class="p">,</span> <span class="n">f_periodic</span><span class="p">,</span> <span class="n">f_linear</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">|</span> <span class="n">Obs</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="n">pred_smooth</span> <span class="o">=</span> <span class="n">f_smooth</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">pred_wiggly</span> <span class="o">=</span> <span class="n">f_wiggly</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">pred_periodic</span> <span class="o">=</span> <span class="n">f_periodic</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">pred_linear</span> <span class="o">=</span> <span class="n">f_linear</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">pred_f</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>


<span class="c1"># Plot results.</span>
<span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">pred</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Prediction&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">pred_f</span><span class="p">,</span> <span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Smooth Component&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_smooth</span><span class="p">,</span> <span class="n">pred_smooth</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Wiggly Component&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_wiggly</span><span class="p">,</span> <span class="n">pred_wiggly</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Periodic Component&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_periodic</span><span class="p">,</span> <span class="n">pred_periodic</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Linear Component&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true_linear</span><span class="p">,</span> <span class="n">pred_linear</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="learn-a-function-incorporating-prior-knowledge-about-its-form">
<h3>Learn a Function, Incorporating Prior Knowledge About Its Form<a class="headerlink" href="#learn-a-function-incorporating-prior-knowledge-about-its-form" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id4">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction3_parametric.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow.contrib.opt</span> <span class="kn">import</span> <span class="n">ScipyOptimizerInterface</span> <span class="k">as</span> <span class="n">SOI</span>
<span class="kn">from</span> <span class="nn">wbml</span> <span class="kn">import</span> <span class="n">vars64</span> <span class="k">as</span> <span class="n">vs</span>

<span class="kn">from</span> <span class="nn">stheno.tf</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># Construct the model.</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">1.</span><span class="p">)))</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">vs</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="n">Delta</span><span class="p">())</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">vs</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">vs</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="n">alpha</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="n">e</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="n">x</span> <span class="o">**</span> <span class="mf">1.8</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">((</span><span class="n">y</span> <span class="o">|</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f_true</span><span class="p">))(</span><span class="n">x_obs</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span>

<span class="c1"># Learn.</span>
<span class="n">lml</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="n">SOI</span><span class="p">(</span><span class="o">-</span><span class="n">lml</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># Print the learned parameters.</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">))</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">((</span><span class="n">f</span> <span class="o">|</span> <span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">())</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="multi-ouput-regression">
<h3>Multi-Ouput Regression<a class="headerlink" href="#multi-ouput-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id5">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction4_multi-output.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">plum</span> <span class="kn">import</span> <span class="n">Dispatcher</span><span class="p">,</span> <span class="n">Referentiable</span><span class="p">,</span> <span class="n">Self</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Kernel</span><span class="p">,</span> <span class="n">Obs</span>


<span class="k">class</span> <span class="nc">VGP</span><span class="p">(</span><span class="n">Referentiable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A vector-valued GP.</span>

<span class="sd">    Args:</span>
<span class="sd">        dim (int): Dimensionality.</span>
<span class="sd">        kernel (instance of :class:`stheno.kernel.Kernel`): Kernel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dispatch</span> <span class="o">=</span> <span class="n">Dispatcher</span><span class="p">(</span><span class="n">in_class</span><span class="o">=</span><span class="n">Self</span><span class="p">)</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Kernel</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">kernel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">GP</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">)]</span>

    <span class="nd">@dispatch</span><span class="p">([</span><span class="n">GP</span><span class="p">])</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">ps</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ps</span> <span class="o">=</span> <span class="n">ps</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="n">Self</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">VGP</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">f</span> <span class="o">+</span> <span class="n">g</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">ps</span><span class="p">)])</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">lmatmul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
        <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">VGP</span><span class="p">(</span><span class="o">*</span><span class="n">ps</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">VGP</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">p</span> <span class="o">|</span> <span class="n">obs</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">obs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ys</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Obs</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">,</span> <span class="n">ys</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ps</span><span class="p">]</span>


<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Model parameters:</span>
<span class="n">m</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

<span class="c1"># Construct latent functions</span>
<span class="n">us</span> <span class="o">=</span> <span class="n">VGP</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">EQ</span><span class="p">())</span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">us</span><span class="o">.</span><span class="n">lmatmul</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>

<span class="c1"># Construct noise.</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">VGP</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Delta</span><span class="p">())</span>

<span class="c1"># Construct observation model.</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">e</span> <span class="o">+</span> <span class="n">fs</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">fs_true</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ys_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ys</span> <span class="o">|</span> <span class="n">fs</span><span class="o">.</span><span class="n">obs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs_true</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span>

<span class="c1"># Condition the model on the observations to make predictions.</span>
<span class="n">preds</span> <span class="o">=</span> <span class="p">(</span><span class="n">fs</span> <span class="o">|</span> <span class="n">ys</span><span class="o">.</span><span class="n">obs</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">ys_obs</span><span class="p">))</span><span class="o">.</span><span class="n">marginals</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="c1"># Plot results.</span>
<span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">pred</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span><span class="p">),</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Output {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fs_true</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">preds</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x_obs</span><span class="p">,</span> <span class="n">ys_obs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="approximate-integration">
<h3>Approximate Integration<a class="headerlink" href="#approximate-integration" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id6">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction5_integration.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">Obs</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Construct the model.</span>
<span class="n">f</span> <span class="o">=</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>

<span class="c1"># Construct derivatives via finite differences.</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">diff_approx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ddf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">diff_approx</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">dddf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">diff_approx</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">e</span>

<span class="c1"># Fix the integration constants.</span>
<span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ddf</span><span class="p">,</span> <span class="n">dddf</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ddf</span><span class="p">,</span> <span class="n">dddf</span><span class="p">)</span> <span class="o">|</span> <span class="n">Obs</span><span class="p">((</span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">df</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">ddf</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Sample observations.</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ddf</span><span class="p">,</span> <span class="n">dddf</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ddf</span><span class="p">,</span> <span class="n">dddf</span><span class="p">)</span> <span class="o">|</span> <span class="n">Obs</span><span class="p">(</span><span class="n">dddf</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># And make predictions.</span>
<span class="n">pred_iiif</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">pred_iif</span> <span class="o">=</span> <span class="n">df</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">pred_if</span> <span class="o">=</span> <span class="n">ddf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">pred_f</span> <span class="o">=</span> <span class="n">dddf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>


<span class="c1"># Plot result.</span>
<span class="k">def</span> <span class="nf">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">x_obs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">pred</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Function&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_f</span><span class="p">,</span> <span class="n">x_obs</span><span class="o">=</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="o">=</span><span class="n">y_obs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Integral of Function&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_if</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Second Integral of Function&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_iif</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Third Integral of Function&#39;</span><span class="p">)</span>
<span class="n">plot_prediction</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">pred_iiif</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="bayesian-linear-regression">
<h3>Bayesian Linear Regression<a class="headerlink" href="#bayesian-linear-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id7">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction6_blr.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Obs</span><span class="p">,</span> <span class="n">dense</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># Construct the model.</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">intercept</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">intercept</span>

<span class="n">e</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>  <span class="c1"># Noise model</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="n">e</span>  <span class="c1"># Observation model</span>

<span class="c1"># Sample a slope, intercept, underlying function, and observations.</span>
<span class="n">true_slope</span><span class="p">,</span> <span class="n">true_intercept</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">y_obs</span> <span class="o">=</span> \
    <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">slope</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">intercept</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">))</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">|</span> <span class="n">Obs</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;true slope&#39;</span><span class="p">,</span> <span class="n">true_slope</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;predicted slope&#39;</span><span class="p">,</span> <span class="n">slope</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;true intercept&#39;</span><span class="p">,</span> <span class="n">true_intercept</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;predicted intercept&#39;</span><span class="p">,</span> <span class="n">intercept</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="gpar">
<h3>GPAR<a class="headerlink" href="#gpar" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id8">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction7_gpar.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">tensorflow.contrib.opt</span> <span class="kn">import</span> <span class="n">ScipyOptimizerInterface</span> <span class="k">as</span> <span class="n">SOI</span>
<span class="kn">from</span> <span class="nn">wbml</span> <span class="kn">import</span> <span class="n">Vars</span>

<span class="kn">from</span> <span class="nn">stheno.tf</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Graph</span><span class="p">,</span> <span class="n">B</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">x_obs1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">inds2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">))[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">x_obs2</span> <span class="o">=</span> <span class="n">x_obs1</span><span class="p">[</span><span class="n">inds2</span><span class="p">]</span>

<span class="c1"># Construct variable storages.</span>
<span class="n">vs1</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">vs2</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="c1"># Construct a model for each output.</span>
<span class="n">m1</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">m2</span> <span class="o">=</span> <span class="n">Graph</span><span class="p">()</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">vs1</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">m1</span><span class="p">)</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">vs1</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">1.</span><span class="p">))</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">vs2</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">m2</span><span class="p">)</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">vs2</span><span class="o">.</span><span class="n">pos</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="o">.</span><span class="mi">5</span><span class="p">]))</span>
<span class="n">sig1</span> <span class="o">=</span> <span class="n">vs1</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">sig2</span> <span class="o">=</span> <span class="n">vs2</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Initialise variables.</span>
<span class="n">vs1</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">vs2</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># Noise models:</span>
<span class="n">e1</span> <span class="o">=</span> <span class="n">sig1</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">m1</span><span class="p">)</span>
<span class="n">e2</span> <span class="o">=</span> <span class="n">sig2</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">(),</span> <span class="n">graph</span><span class="o">=</span><span class="n">m2</span><span class="p">)</span>

<span class="c1"># Observation models:</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">+</span> <span class="n">e1</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">f2</span> <span class="o">+</span> <span class="n">e2</span>

<span class="c1"># Construction functions to predict and observations.</span>
<span class="n">f1_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">f2_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="n">y1_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">y2_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs2</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Learn.</span>
<span class="n">lml1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y1_obs</span><span class="p">)</span>
<span class="n">SOI</span><span class="p">(</span><span class="o">-</span><span class="n">lml1</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="n">vs1</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">lml2</span> <span class="o">=</span> <span class="n">y2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_obs2</span><span class="p">,</span> <span class="n">y1_obs</span><span class="p">[</span><span class="n">inds2</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y2_obs</span><span class="p">)</span>
<span class="n">SOI</span><span class="p">(</span><span class="o">-</span><span class="n">lml2</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="n">vs2</span><span class="o">.</span><span class="n">vars</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># Predict first output.</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">|</span> <span class="p">(</span><span class="n">y1</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">),</span> <span class="n">y1_obs</span><span class="p">)</span>
<span class="n">mean1</span><span class="p">,</span> <span class="n">lower1</span><span class="p">,</span> <span class="n">upper1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">())</span>

<span class="c1"># Predict second output with Monte Carlo.</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">f2</span> <span class="o">|</span> <span class="p">(</span><span class="n">y2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x_obs2</span><span class="p">,</span> <span class="n">y1_obs</span><span class="p">[</span><span class="n">inds2</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="n">y2_obs</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">f2</span><span class="p">(</span><span class="n">B</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">x</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">],</span> <span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">()],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
<span class="n">samples</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">mean2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">lower2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">upper2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Output 1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f1_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs1</span><span class="p">,</span> <span class="n">y1_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Output 2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f2_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs2</span><span class="p">,</span> <span class="n">y2_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="a-gprnn-model">
<h3>A GP–RNN Model<a class="headerlink" href="#a-gprnn-model" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id9">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction8_gp-rnn.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">wbml</span> <span class="kn">import</span> <span class="n">Vars</span><span class="p">,</span> <span class="n">rnn</span> <span class="k">as</span> <span class="n">rnn_constructor</span>

<span class="kn">from</span> <span class="nn">stheno.tf</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">RQ</span><span class="p">,</span> <span class="n">Obs</span>

<span class="c1"># Construct variable storages.</span>
<span class="n">vs_gp</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">vs_rnn</span> <span class="o">=</span> <span class="n">Vars</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Construct a 1-layer RNN with GRUs.</span>
<span class="n">f_rnn</span> <span class="o">=</span> <span class="n">rnn_constructor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,))</span>
<span class="n">f_rnn</span><span class="o">.</span><span class="n">initialise</span><span class="p">(</span><span class="n">vs_rnn</span><span class="p">)</span>


<span class="c1"># Wrap the RNN to be compatible with Stheno.</span>
<span class="k">def</span> <span class="nf">rnn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">f_rnn</span><span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">None</span><span class="p">])[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>


<span class="c1"># Construct session.</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

<span class="c1"># Construct points which to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="n">inds_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.75</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1"># Train on the first 75% only.</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">inds_obs</span><span class="p">]</span>

<span class="c1"># Construct function and observations.</span>
<span class="c1">#   Draw a random fluctuation.</span>
<span class="n">k_u</span> <span class="o">=</span> <span class="o">.</span><span class="mi">2</span> <span class="o">*</span> <span class="n">RQ</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">)</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">GP</span><span class="p">(</span><span class="n">k_u</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span><span class="o">.</span><span class="n">sample</span><span class="p">())</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="c1">#   Construct the true, underlying function.</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
<span class="c1">#   Add noise.</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="n">f_true</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="c1"># Normalise and split.</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_true</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
<span class="n">y_true</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_true</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">y_true</span><span class="p">[</span><span class="n">inds_obs</span><span class="p">]</span>

<span class="c1"># Construct the model.</span>
<span class="n">a</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">vs_gp</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span><span class="o">.</span><span class="n">stretch</span><span class="p">(</span><span class="n">vs_gp</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">vs_gp</span><span class="o">.</span><span class="n">pos</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span> <span class="o">*</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>

<span class="c1"># RNN-only model:</span>
<span class="n">y_rnn</span> <span class="o">=</span> <span class="n">rnn</span> <span class="o">+</span> <span class="n">e</span>

<span class="c1"># GP-RNN model:</span>
<span class="n">f_gp_rnn</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">rnn</span> <span class="o">+</span> <span class="n">b</span>
<span class="n">y_gp_rnn</span> <span class="o">=</span> <span class="n">f_gp_rnn</span> <span class="o">+</span> <span class="n">e</span>

<span class="c1"># Construct evidences.</span>
<span class="n">lml_rnn</span> <span class="o">=</span> <span class="n">y_rnn</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>
<span class="n">lml_gp_rnn</span> <span class="o">=</span> <span class="n">y_gp_rnn</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># Construct optimisers and initialise.</span>
<span class="n">opt_rnn</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="o">-</span><span class="n">lml_rnn</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="n">vs_rnn</span><span class="o">.</span><span class="n">vars</span>
<span class="p">)</span>
<span class="n">opt_jointly</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="mf">1e-3</span><span class="p">)</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span>
    <span class="o">-</span><span class="n">lml_gp_rnn</span><span class="p">,</span> <span class="n">var_list</span><span class="o">=</span><span class="n">vs_rnn</span><span class="o">.</span><span class="n">vars</span> <span class="o">+</span> <span class="n">vs_gp</span><span class="o">.</span><span class="n">vars</span>
<span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">())</span>

<span class="c1"># Nudge the RNN into the right direction.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2000</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">opt_rnn</span><span class="p">,</span> <span class="n">lml_rnn</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

<span class="c1"># Jointly train the RNN and GPs.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">opt_jointly</span><span class="p">,</span> <span class="n">lml_gp_rnn</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

<span class="c1"># Condition.</span>
<span class="n">f_gp_rnn</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_gp_rnn</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">|</span> <span class="n">Obs</span><span class="p">(</span><span class="n">y_gp_rnn</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>

<span class="c1"># Predict and plot results.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$(1 + a) </span><span class="se">\\</span><span class="s1">cdot $ RNN ${}+b$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">f_gp_rnn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$a$&#39;</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;$b$&#39;</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="approximate-multiplication-between-gps">
<h3>Approximate Multiplication Between GPs<a class="headerlink" href="#approximate-multiplication-between-gps" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id10">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction9_product.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Obs</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Construct a prior.</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Compute the approximate product.</span>
<span class="n">f_prod</span> <span class="o">=</span> <span class="n">f1</span> <span class="o">*</span> <span class="n">f2</span>

<span class="c1"># Sample two functions.</span>
<span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># Predict.</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_prod</span> <span class="o">|</span> <span class="p">((</span><span class="n">f1</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">s1</span><span class="p">),</span> <span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">s2</span><span class="p">)))(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sample 1&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sample 2&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">s2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True product&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Approximate posterior&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="sparse-regression">
<h3>Sparse Regression<a class="headerlink" href="#sparse-regression" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id11">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction10_sparse.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id11" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">SparseObs</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">50</span><span class="n">_000</span><span class="p">)</span>
<span class="n">x_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># Construct a prior.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">()</span><span class="o">.</span><span class="n">periodic</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>  <span class="c1"># Latent function.</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>  <span class="c1"># Noise.</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">e</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">f_true</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x_obs</span><span class="p">)</span> <span class="o">+</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">x_obs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Now condition on the observations to make predictions.</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">SparseObs</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x_ind</span><span class="p">),</span>  <span class="c1"># Inducing points.</span>
                <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="n">e</span><span class="p">,</span>  <span class="c1"># Noise process.</span>
                <span class="c1"># Observations _without_ the noise process added on.</span>
                <span class="n">f</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;elbo&#39;</span><span class="p">,</span> <span class="n">obs</span><span class="o">.</span><span class="n">elbo</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">|</span> <span class="n">obs</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>

<span class="c1"># Plot result.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_ind</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">x_ind</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Inducing Points&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="smoothing-with-nonparametric-basis-functions">
<h3>Smoothing with Nonparametric Basis Functions<a class="headerlink" href="#smoothing-with-nonparametric-basis-functions" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id12">
<img alt="Prediction" src="https://raw.githubusercontent.com/wesselb/stheno/master/readme_prediction11_nonparametric_basis.png" />
<p class="caption"><span class="caption-text">Prediction</span><a class="headerlink" href="#id12" title="Permalink to this image">¶</a></p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">stheno</span> <span class="kn">import</span> <span class="n">GP</span><span class="p">,</span> <span class="n">EQ</span><span class="p">,</span> <span class="n">Delta</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Obs</span>

<span class="c1"># Define points to predict at.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="c1"># Constuct a prior:</span>
<span class="n">w</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># Window</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[(</span><span class="n">GP</span><span class="p">(</span><span class="n">EQ</span><span class="p">())</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x_obs</span><span class="p">]</span>  <span class="c1"># Weighted basis functions</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># Latent function</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">GP</span><span class="p">(</span><span class="n">Delta</span><span class="p">())</span>  <span class="c1"># Noise</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">e</span>  <span class="c1"># Observation model</span>

<span class="c1"># Sample a true, underlying function and observations.</span>
<span class="n">f_true</span><span class="p">,</span> <span class="n">y_obs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">))</span>

<span class="c1"># Condition on the observations to make predictions.</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Obs</span><span class="p">(</span><span class="n">y</span><span class="p">(</span><span class="n">x_obs</span><span class="p">),</span> <span class="n">y_obs</span><span class="p">)</span>
<span class="n">f</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">|</span> <span class="n">obs</span><span class="p">,</span> <span class="n">b</span> <span class="o">|</span> <span class="n">obs</span><span class="p">)</span>

<span class="c1"># Plot result.</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">bi</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
    <span class="n">kw_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Basis functions&#39;</span><span class="p">}</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw_args</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f_true</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;True&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x_obs</span><span class="p">,</span> <span class="n">y_obs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observations&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:red&#39;</span><span class="p">)</span>
<span class="n">mean</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">marginals</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediction&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="Application Programming Interface" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Wessel Bruinsma

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>